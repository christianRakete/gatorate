#!/usr/bin/env ruby

require 'bundler/setup'
require 'dcell'
require 'wiringpi'

class Door
  include Celluloid
  
  def initialize(pin=8)
    @io = WiringPi::GPIO.new
    @io.mode(pin, INPUT)
  end

  def open?
    status == :open
  end

  def closed?
    !open?
  end
       
  def pin_state
    @io.read(@button_pin).to_i == 1 ? :open : :closed
  end
  alias :pin_state :status
end


Door.supervise_as :door_actor
DCell.start :addr => "tcp://127.0.0.1:9012", :id => "door.local"

sleep